{% extends "base.html" %}

{% block title %}PO List{% endblock %}

{% block content %}
  <a href="{{ url_for('main.create_po') }}" class="btn">Create New PO</a>

  <form method="get" style="margin: 1em 0;">
    <label>
      Filter by Project Number:
      <input type="text" name="projectnumber" value="{{ projectnumber or '' }}">
    </label>
    <button type="submit">Apply</button>
    <a href="{{ url_for('main.po_list') }}">Clear</a>
  </form>

<!-- This table uses a view 'active_po_list' created by/in supabase -->

  <table>
    <thead>
      <tr>
        <th>PO Number</th>
        <th>Project</th>
        <th>Supplier</th>
        <th>Status</th>
        <th>Revision</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% if not pos %}
        <tr><td colspan="6" style="text-align:center; color:#888;">No purchase orders match your filter.</td></tr>
      {% else %}
        {% for po in pos %}
          {% set po_id = po.id or po.purchase_order_id %}
          {% set pn = po.po_number %}
          <tr>
            <td>
              {# Safely zero-pad if numeric, else show raw #}
              {% if pn is not none and pn|string|trim != '' and (pn|string).isdigit() %}
                {{ ("%06d"|format(pn|int)) }}
              {% else %}
                {{ pn or "" }}
              {% endif %}
            </td>
            <td>{{ po.projectnumber or po.project_id or "" }}</td>
            <td>{{ po.supplier_name or "" }}</td>
            <td>
              {% set st = (po.status or "")|lower %}
              <span class="status-tag status-{{ st }}">{{ st|capitalize }}</span>
            </td>
            <td>{{ po.current_revision or "" }}</td>
            <td>
              <a class="btn btn-small" href="{{ url_for('main.po_preview', po_id=po_id) }}">View PO</a>
            </td>
          </tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>
{% endblock %}

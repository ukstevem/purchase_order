version: "3.9"

services:
  web:
    container_name: po_system
    build:
      context: .                # repo root
      dockerfile: DockerfileforPI
      platforms:
        - linux/arm64/v8        # Raspberry Pi 64-bit OS
        # - linux/arm/v7        # Uncomment if using 32-bit Pi OS
    environment:
      # Fill these in Portainer's "Env" tab (recommended). Examples:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_KEY: ${SUPABASE_KEY}
      SECRET_KEY: ${SECRET_KEY}
      FLASK_ENV: ${FLASK_ENV:-production}
      NETWORK_ARCHIVE_DIR: /mnt/share/Purchase Orders
      SAVE_PDF_ON_DOWNLOAD: "1"
      # FLASK_DEBUG: "0"
      # PREFERRED_URL_SCHEME: http

      # ==== NEW: Outlook/Graph integration ====
      MS_TENANT_ID: ${MS_TENANT_ID}
      MS_CLIENT_ID: ${MS_CLIENT_ID}
      MS_CLIENT_SECRET: ${MS_CLIENT_SECRET}
      MS_OUTLOOK_MAILBOX: ${MS_OUTLOOK_MAILBOX}

    ports:
      - "80:8000"             # host:container
    volumes:
      - ./instance:/app/instance
      - ./output:/app/output
      - "/mnt/po_share:/mnt/share:rw"
    restart: unless-stopped
    # If your app binds only on 127.0.0.1, add: command: flask run --host=0.0.0.0 --port=8000
